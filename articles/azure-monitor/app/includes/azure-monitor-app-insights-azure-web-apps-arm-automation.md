---
ms.topic: include
ms.date: 03/31/2025
---

### App Service application settings with Azure Resource Manager

Application settings for Azure App Service can be managed and configured with [Azure Resource Manager templates](/azure/azure-resource-manager/templates/syntax). You can use this method when you deploy new App Service resources with Resource Manager automation or modify the settings of existing resources.

The basic structure of the application settings JSON for an App Service resource:

```JSON
      "resources": [
        {
          "name": "appsettings",
          "type": "config",
          "apiVersion": "2015-08-01",
          "dependsOn": [
            "[resourceId('Microsoft.Web/sites', variables('webSiteName'))]"
          ],
          "tags": {
            "displayName": "Application Insights Settings"
          },
          "properties": {
            "key1": "value1",
            "key2": "value2"
          }
        }
      ]
```

### Automate the creation of an Application Insights resource and link to your newly created App Service resource

To create a Resource Manager template with the default Application Insights settings, begin the process as if you were going to create a new web app with Application Insights enabled.

1. In the Azure portal, create a new Web App resource with your desired information. **Enable Application Insights** on the **Monitor + secure** tab.

1. Go to **Review + create**, then select **Download a template for automation**.

    :::image type="content" source="../media/codeless-app-service/create-web-app.png" alt-text="Screenshot that shows the App Service web app creation menu." lightbox="../media/codeless-app-service/create-web-app.png":::

    This option generates the latest Resource Manager template with all required settings configured.
    
    :::image type="content" source="../media/codeless-app-service/arm-template.png" alt-text="Screenshot that shows an App Service web app template." border="false" lightbox="../media/codeless-app-service/arm-template.png":::

In the following sample, replace all instances of `my-net-app` with your site name:

> [!NOTE]
> The following template is for a .NET 8 (LTS) application running on Linux. For Windows, make the appropriate changes based comments in the template. If you want to use a different runtime stack (for example, Java 21 or Node.js 22 LTS), we recommend creating your own template based on the instructions above.
,
```json
{
    "resources": [
        {
            "apiVersion": "2022-03-01",
            "name": "[parameters('name')]",
            "type": "Microsoft.Web/sites",
            "location": "[parameters('location')]",
            "tags": null,
            "dependsOn": [
                "microsoft.insights/components/my-net-app", // Replace "my-net-app" with the name of your web application.
                "[concat('Microsoft.Web/serverfarms/', parameters('hostingPlanName'))]"
            ],
            "properties": {
                "name": "[parameters('name')]",
                "siteConfig": {
                    "appSettings": [
                        {
                            "name": "APPLICATIONINSIGHTS_CONNECTION_STRING",
                            "value": "[reference('microsoft.insights/components/my-net-app', '2015-05-01').ConnectionString]" // Replace "my-net-app" with the name of your web application.
                        },
                        {
                            "name": "ApplicationInsightsAgent_EXTENSION_VERSION",
                            "value": "~3" // For Windows, change value to "~2".
                        },
                        {
                            "name": "XDT_MicrosoftApplicationInsights_Mode",
                            "value": "Recommended" // For Windows, change value to "default".
                        }
                    ],

// For Windows, uncomment this block:

//                  "metadata": [
//                      {
//                          "name": "CURRENT_STACK",
//                          "value": "[parameters('currentStack')]"
//                      }
//                  ],
//                  "phpVersion": "[parameters('phpVersion')]",
//                  "netFrameworkVersion": "[parameters('netFrameworkVersion')]",

                    "linuxFxVersion": "[parameters('linuxFxVersion')]", // For Windows, remove this line.
                    "alwaysOn": "[parameters('alwaysOn')]",
                    "ftpsState": "[parameters('ftpsState')]"
                },
                "serverFarmId": "[concat('/subscriptions/', parameters('subscriptionId'),'/resourcegroups/', parameters('serverFarmResourceGroup'), '/providers/Microsoft.Web/serverfarms/', parameters('hostingPlanName'))]",
                "clientAffinityEnabled": false,
                "virtualNetworkSubnetId": null,
                "httpsOnly": true,
                "publicNetworkAccess": "Enabled",
                "autoGeneratedDomainNameLabelScope": "[parameters('autoGeneratedDomainNameLabelScope')]"
            },
            "resources": [
                {
                    "type": "Microsoft.Web/sites/basicPublishingCredentialsPolicies",
                    "apiVersion": "2022-09-01",
                    "name": "[concat(parameters('name'), '/scm')]",
                    "properties": {
                        "allow": true // For Windows, set to false.
                    },
                    "dependsOn": [
                        "[resourceId('Microsoft.Web/Sites', parameters('name'))]"
                    ]
                },
                {
                    "type": "Microsoft.Web/sites/basicPublishingCredentialsPolicies",
                    "apiVersion": "2022-09-01",
                    "name": "[concat(parameters('name'), '/ftp')]",
                    "properties": {
                        "allow": true // For Windows, set to false.
                    },
                    "dependsOn": [
                        "[resourceId('Microsoft.Web/Sites', parameters('name'))]"
                    ]
                }
            ]
        },
        {
            "apiVersion": "2018-11-01",
            "name": "[parameters('hostingPlanName')]",
            "type": "Microsoft.Web/serverfarms",
            "location": "[parameters('location')]",
            "kind": "linux", // For Windows, leave empty ("").
            "tags": null,
            "dependsOn": [],
            "properties": {
                "name": "[parameters('hostingPlanName')]",
                "workerSize": "[parameters('workerSize')]",
                "workerSizeId": "[parameters('workerSizeId')]",
                "numberOfWorkers": "[parameters('numberOfWorkers')]",
                "reserved": true, // For Windows, remove this line.
                "zoneRedundant": false
            },
            "sku": {
                "Tier": "[parameters('sku')]",
                "Name": "[parameters('skuCode')]"
            }
        },
        {
            "apiVersion": "2020-02-02-preview",
            "name": "my-net-app", // Replace "my-net-app" with the name of your web application.
            "type": "microsoft.insights/components",
            "location": "centralus", // Replace "centralus" with your location of choice.
            "tags": null,
            "dependsOn": [
                "newWorkspaceTemplate"
            ],
            "properties": {
                "ApplicationId": "[parameters('name')]",
                "Request_Source": "IbizaWebAppExtensionCreate",
                "Flow_Type": "Redfield",
                "Application_Type": "web",
                "WorkspaceResourceId": "/subscriptions/aaaa0a0a-bb1b-cc2c-dd3d-eeeeee4e4e4e/resourceGroups/DefaultResourceGroup-CUS/providers/Microsoft.OperationalInsights/workspaces/DefaultWorkspace-aaaa0a0a-bb1b-cc2c-dd3d-eeeeee4e4e4e-CUS" // Replace aaaa0a0a-bb1b-cc2c-dd3d-eeeeee4e4e4e with your subscription ID. Notice that it apperas twice!
            }
        },
        {
            "type": "Microsoft.Resources/deployments",
            "apiVersion": "2021-04-01",
            "name": "newWorkspaceTemplate",
            "resourceGroup": "DefaultResourceGroup-CUS",
            "subscriptionId": "[parameters('subscriptionId')]",
            "properties": {
                "mode": "Incremental",
                "template": {
                    "$schema": "https://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#",
                    "contentVersion": "1.0.0.0",
                    "parameters": {},
                    "variables": {},
                    "resources": [
                        {
                            "apiVersion": "2020-08-01",
                            "name": "DefaultWorkspace-aaaa0a0a-bb1b-cc2c-dd3d-eeeeee4e4e4e-CUS", // Replace aaaa0a0a-bb1b-cc2c-dd3d-eeeeee4e4e4e with your subscription ID.
                            "type": "Microsoft.OperationalInsights/workspaces",
                            "location": "centralus", // Replace "centralus" with your location of choice.
                            "properties": {}
                        }
                    ]
                }
            }
        }
    ]
    "parameters": {
        "subscriptionId": {
            "type": "string"
        },
        "resourceGroupName": {
            "type": "string"
        },
        "name": {
            "type": "string"
        },
        "location": {
            "type": "string"
        },
        "hostingPlanName": {
            "type": "string"
        },
        "serverFarmResourceGroup": {
            "type": "string"
        },
        "alwaysOn": {
            "type": "bool"
        },
        "ftpsState": {
            "type": "string"
        },
        "autoGeneratedDomainNameLabelScope": {
            "type": "string"
        },
        "sku": {
            "type": "string"
        },
        "skuCode": {
            "type": "string"
        },
        "workerSize": {
            "type": "string"
        },
        "workerSizeId": {
            "type": "string"
        },
        "numberOfWorkers": {
            "type": "string"
        },

// For Windows, uncomment this block:

//      "currentStack": {
//      "type": "string"
//      },
//      "phpVersion": {
//          "type": "string"
//      },
//      "netFrameworkVersion": {
//          "type": "string"
//      }

        "linuxFxVersion": { // For Windows, remove "linuxFXVersion".
            "type": "string"
        }
    },
    "variables": {},
    "$schema": "http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#",
    "contentVersion": "1.0.0.0",

}
```


### Enable through PowerShell

To enable the application monitoring through PowerShell, only the underlying application settings must be changed. The following sample enables application monitoring for a website called `AppMonitoredSite` in the resource group `AppMonitoredRG`. It configures data to be sent to the `InstrumentationKey=012345678-abcd-ef01-2345-6789abcd` connection string.

[!INCLUDE [updated-for-az](~/reusable-content/ce-skilling/azure/includes/updated-for-az.md)]

> [!NOTE]
> For Windows, set ApplicationInsightsAgent_EXTENSION_VERSION to `~2`.
>
> For Linux, set ApplicationInsightsAgent_EXTENSION_VERSION to `~3`.

```powershell
$app = Get-AzWebApp -ResourceGroupName "AppMonitoredRG" -Name "AppMonitoredSite" -ErrorAction Stop
$newAppSettings = @{} # Case-insensitive hash map
$app.SiteConfig.AppSettings | %{$newAppSettings[$_.Name] = $_.Value} # Preserve non-Application-Insights application settings.
$newAppSettings["APPLICATIONINSIGHTS_CONNECTION_STRING"] = "InstrumentationKey=012345678-abcd-ef01-2345-6789abcd"; # Set the Application Insights connection string
$newAppSettings["ApplicationInsightsAgent_EXTENSION_VERSION"] = "~3"; # Enable the ApplicationInsightsAgent.
$app = Set-AzWebApp -AppSettings $newAppSettings -ResourceGroupName $app.ResourceGroup -Name $app.Name -ErrorAction Stop
```
