---
title: Configure Azure Monitor with Network Security Perimeter
description: Details on adding Azure Monitor resources to your network security perimeter.
ms.topic: conceptual
ms.date: 5/28/2025
---

# Troubleshoot Azure Monitor with Network Security Perimeter (Preview)

| Scenario | Description | Network Security Perimeter with defined Inbound Rules - Supported Scenarios & Expected Behavior |
|:---|:---|:---|
| Azure Monitor - Container Insights | Monitors the Performance, health, and utilization of managed and self-managed Kubernetes clusters including AKS. | Log Analytics Workspace is associated to Network Security Perimeter with inbound rules defined.<br><br>Allow the traffic if IP based rule specified and match the source resource's IP address<br>Allow if Subscription Id based rule specified and match the source subscription Id<br>Allowed for resource in the transition mode.<br>Deny if source resource doesn't match any rules (IP address, Subscription ID) |
| Azure Monitor - Virtual Machine Insights | Monitors your Azure VMs and Virtual Machine Scale Sets at scale. It analyzes the performance and health of your Windows and Linux VMs and monitors their processes and dependencies on other resources and external processes. | Log Analytics Workspace is associated to Network Security Perimeter with inbound rules defined.<br><br>Allow the traffic if IP based rule specified and match the source resource's IP address<br>Allow if Subscription Id based rule specified and match the source subscription Id<br>Allowed for resource in the transition mode.Deny if source resource doesn't match any rules (IP address, Subscription ID) |
| Logs Ingestion API in Azure Monitor | The Logs Ingestion API in Azure Monitor lets you send data to a Log Analytics workspace using either a REST API call or client libraries. | Log Analytics Workspace is associated to Network Security Perimeter with inbound rules defined.Allow the traffic if IP based rule specified and match the source resource's IP addressDeny if source resource doesn't match any rules (IP address) |
| Log Analytics Workspace Export to Storage Account | Export logs from Log Analytics workspace to the storage account destination. | Log Analytics Workspace and storage account is associated to Network Security Perimeter with inbound rules definedAllow if the storage account is within same perimeter as Log Analytics Workspace.Exporting tables from Log Analytics to a storage account is only supported when both the Log Analytics workspace(s) and storage account(s) are within the same perimeter. If they are not, the export table traffic will be denied. |
| Platform logs for DCR resource | Platform Logs for the Data Collection Rules resource | Allow if the destination resource is within the same perimeter as DCE. If they are not, the logs traffic will be denied. |
| Data Collector API - using LAW Key | The Azure Monitor Data Collector API (DCA) allows you to send custom data to Log Analytics workspaces using a REST API. | Allow the traffic if IP based rule specified and match the source resource's IP addressAllowed for resource in the transition mode.Deny if source resource doesn't match any rules (IP address)Ignore NSP/Resource Id claims in header |
| MMA Agent | MMA has been officially retired for most use cases. We suggest using the Azure Monitor Agent (AMA) instead. | Log Analytics Workspace is associated to Network Security Perimeter with inbound rules defined.Allow the traffic if IP based rule specified and match the source resource's IP addressAllowed for resource in the transition mode.Deny if source resource doesn't match any rules (IP address)Ignore NSP/Resource Id claims in header |
| AMA Agent | Azure Monitor Agent (AMA) is a versatile and lightweight agent designed to collect telemetry from virtual machines (VMs) across Azure, on-premises, or other cloud environments. | Log Analytics Workspace is associated to Network Security Perimeter with inbound rules defined.Allow the traffic if IP based rule specified and match the source resource's IP addressAllowed for resource in the transition mode.Deny if source resource doesn't match any rules (IP address)Ignore NSP/Resource Id claims in header |
| Diagnostic Settings - For other Azure PaaS Services (All other tables) | Diagnostic Settings - For other Azure PaaS Services (All other tables) | Log Analytics Workspace is associated to Network Security Perimeter with inbound rules defined.If an IP-based rule is specified and matches the source resource's IP address then allow the traffic . Additionally, allow traffic if both the primary PaaS resource (where diagnostic settings are configured) and the Log Analytics Workspace are within the same perimeter.Deny if source resource doesn't match any rules |
| Application Insights IngestionREST API, Diagnostics Extension | Application Insights IngestionREST API, Diagnostics Extension | Note:Network Security Perimeter is not available on Application Insights resources. Please use the associated log analytics workspace to configure Network Security Perimeter access.Log Analytics Workspace is associated to Network Security Perimeter with inbound rules defined.Allow the traffic if IP based rule specified and match the source resource's IP addressAllowed for resource in the transition mode.Deny if source resource doesn't match any rules (IP address) |
| Live Metrics( Ingestion and query) | Utilize live metrics from Application Insights to monitor web applications. You can select and filter metrics and performance counters to observe in real time and examine stack traces from sample failed requests and exceptions. | Note:Network Security Perimeter is not available on Application Insights resources. Please use the associated log analytics workspace to configure Network Security Perimeter access.Log Analytics Workspace is associated to Network Security Perimeter with inbound rules defined.Allow the traffic if IP based rule specified and match the source resource's IP addressAllowed for resource in the transition mode.Deny if source resource doesn't match any rules (IP address) |

## Log Analytics workspace query scenarios

| Scenario | Description | Network Security Perimeter with defined Inbound Rules - Supported Scenarios & Expected Behavior |
|:---|:---|:---|
| Query - User request with single LAW in the URL | Retrieve log data from the Log analytics workspace | Log Analytics Workspace associated to Network Security Perimeter with inbound rules definedAllow the traffic if IP based rule specified and match the source resource's IP addressAllow if Subscription Id based rule specified and match the source subscription IdAllowed for resource in the transition mode.Allowed within the same perimeterDeny if source resource doesn't match any rules (IP address, Subscription ID) |
| Log Analytics Query and Log Search Alerts | Log Analytics Query and Log Search Alerts | Log Analytics Workspace associated to Network Security Perimeter with inbound rules definedAllow the traffic if IP based rule specified and match the source resource's IP addressAllow if Subscription Id based rule specified and match the source subscription IdAllowed for resource in the transition mode.Allowed within the same perimeterDeny if source resource doesn't match any rules (IP address, Subscription ID) |
| External OperatorEnabled and Explicit cross-resource referencesResource-centric queries | External operator are disabled, but cross resources queries are enabled. | Denied by default. The Network Security Perimeter is in place to prevent data exfiltration risks. |
| Purge/Data Deletion (ARM paths) | Purge or Data Delete operation in Log Analytics workspace | Denied by default. The Network Security Perimeter is in place to prevent data exfiltration risks. |
| Logs Export | Logs export in Log Analytics workspace | Denied by default. The Network Security Perimeter is in place to prevent data exfiltration risks. |

| Scenario | Description | Network Security Perimeter with defined Inbound Rules - Supported Scenarios & Expected Behavior |
|:---|:---|:---|
| Alerts - Log Search Alerts involving a single Log Analytics Workspace | Alerts - Log Search Alerts for a single Log Analytics Workspaces with Action Groups configured within the same network security perimeter. Allow traffic only for resources within the same perimeter. | Log Analytics Workspace, Log Search Alerts and Action Groups are associated to Network Security Perimeter with the perimeter rules definedAllowed for resource in the transition mode.Allowed within the same perimeterDeny if source resource doesn't match any rules (IP address, Subscription ID) |
| Alerts - Log Search Alerts involving multiple Log Analytics Workspace | Alerts - Log Search Alerts involve multiple Log Analytics Workspaces with Action Groups configured within the same network security perimeter. Allow traffic only for resources within the same perimeter; otherwise, deny the traffic. | Log Analytics Workspace, Log Search Alerts and Action Groups are associated to Network Security Perimeter with the perimeter rules definedAllowed for resource in the transition mode.Allowed within the same perimeterDeny if source resource doesn't match any rules (IP address, Subscription ID) |

| Scenario | Description | Network Security Perimeter with defined Inbound Rules - Supported Scenarios & Expected Behavior |
|:---|:---|:---|
| Action Groups - Receive Notifications | Action groups are a collection of notification preferences and actions. | Log Analytics Workspace, Log Search Alerts and Action Groups are associated to Network Security Perimeter with the perimeter rules definedAllow if Subscription Id based rule specified and match the source subscription IdAllowed when all resources are within the same perimeterDeny if source resource doesn't match any rules (IP address, Subscription ID) |
| Action Groups - Send notification to SMS/E-Mail | Action groups are a collection of notification preferences and actions to send notifications to SMS/E-mail. | Log Analytics Workspace, Log Search Alerts and Action Groups are associated to Network Security Perimeter with the perimeter rules definedAllow if destination allowed per Outbound rules - SMS/E-MailAllowed when all resources are within the same perimeterDeny if source resource doesn't match any rules (IP address, Subscription ID) |



## Next steps

* Read more about [Network Security Perimeter](/azure/private-link/network-security-perimeter-concepts) in Azure.
